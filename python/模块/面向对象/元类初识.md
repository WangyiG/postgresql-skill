## 元类、类、类实例
类创建实例,元类创建类,元类之于类相当于类之于实例
#### 类创建对象
- 重点关注三大魔法方法new,init,call
- __new__:绑定于cls当前类,在类创建对象中基本不重写,主要用在自定义元类中,主要负责返回一个未初始化的对象instance,instance会传递给init中的self
- __init__:绑定于__new__返回的实例,初始化实例对象,可以粗浅理解为在这里给实例统一添加属性
- __call__:绑定于__new__返回的实例,在实例被调用时触发
```py
class Cat:
    def __new__(cls,*args,**kwargs):
        print('执行1:类中new方法,创建实例时调用')
        instance_ = super().__new__(cls)
        instance_.test = 'a test attr'
        return instance_
        
    def __init__(self,name):
        print('执行2:类中init方法,初始化实例时调用')
        self.name = name

    def __call__(self,*args,**keargs):
        return '执行3:实例被调用时才会触发'
        
        
# 创建实例会调用new与init
cat = Cat('ketty')              # 返回: 执行1:类中new方法,创建实例时调用   执行2:类中init方法,初始化实例时调用


# 调用实例会执行call
cat()                           # 返回：'执行3:实例被调用时才会触发'

# 在new中创建的实例传递给了self,所以初始化后的实例拥有test属性
cat.test                        # 返回：'a test attr'

# 在init中初始化的属性
cat.name                        # 返回：'ketty'

# 既然说类是由元类实例化所来,那么Cat的元类是什么呢？是type,其为py所有类默认的元类
type(Cat)                       # 返回：type
```
#### 快速使用自定义元类
- 自定义元类必须继承type,否则就是普通的类
```py
class MyMeta(type): 
    
    '''
    早于__init__方法执行,必须返回一个元类实例对象,
    由于该方法是调用类后第一个运行的方法,此时并没有对象产生,因此该方法的第一个参数必须是类本身(MyMeta),
    *args,**kwargs用来接收调用元类产生对象所需的参数(类名 类的基类 名称空间)
    '''
    
    def __new__(cls,*args, **kwargs):
        print('执行1:元类的new方法,在类创建完毕时就已经执行')
        return super().__new__(cls, *args, **kwargs)  # 直接调用父类type中的__new__方法
    
    '''
    通过__init__控制类的产生,
    调用自定义元类与调用内置元类type的方式相同,需要传入类名、基类、类体代码的名称空间
    __init__方法中第一个参数来自于__new__方法返回的元类实例对象
    在该方法内可以控制类的初始化
    '''
    
    def __init__(self, class_name, class_bases, class_dict):
        print('执行2:元类的init方法,初始化元类实例')
        # 实现类名首字母必须大写，否则抛出异常
        if not class_name[0].istitle():  
            raise NameError('类名的首字母必须大写')

        # 实现类必须有文档注释，否则抛出异常
        if '__doc__' not in class_dict or len(class_dict['__doc__'].strip())==0:  
            raise TypeError('必须有文档注释')

        # 实现类名一定要有Meta字样,否则异常
        assert class_name.__contains__(MyMeta.__name__),'元类是自定义元类的类请在类名中注明所使用的元类名'

    def __call__(self,*args, **kwds):
        print('执行3:元类的call方法,在类被调用即类实例化时执行,秘密在type的call中')
        return super().__call__(*args, **kwds)
        
# 元类实例创建会执行1,2       
class Dog_MyMeta(metaclass=MyMeta):
    '''元类init规定我必须要有一个注释'''
    
    def __init__(self,name):
        print('执行4:元类实例的init方法,在类实例对象创建时执行')
        self.name = name

# 类实例创建会执行3,4
d = Dog_MyMeta('petty')
```



