## 创建新项目与app
```sh
django-admin startproject logindemo
cd logindemo
django-admin startapp loginapp
```
## 新建数据库
```sql
create database drf_login
```
## 项目配置
```py
# 注册rest_framework与loginapp
INSTALLED_APPS = [
     ...,
    'rest_framework',
    'loginapp.apps.LoginappConfig'
]

# 配置数据库
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',     
        'NAME': 'drf',                              
        'USER': 'mt',                                  
        'PASSWORD': 'postgres',                        
        'HOST': '127.0.0.1',
        'PORT': '5432',
      }
    }

# 配置本地化
LANGUAGE_CODE = 'zh-hans'
TIME_ZONE = 'Asia/Shanghai'
USE_I18N = True
USE_L10N = True
USE_TZ = False
```
## 配置表模型并激活
```py
from django.db import models


class User(models.Model):
    username = models.CharField(max_length=32)
    password = models.CharField(max_length=32)
    # 通过实例的get_字段_display()方法来取对应字符串
    user_type = models.IntegerField(choices=((0, '超级用户'), (1, '管理员'), (2, '普通用户')))


class UserToken(models.Model):
    # 注意on_delete参数不要漏
    name = models.OneToOne(to=User,on_delete=models.CASCADE)
    token = models.TextField()
```
```sh
python manage.py makemigrations
python manage.py migrate
```
## 配置视图类
```py
class UserView(ViewSet):
    @action(methods=['POST', 'GET'], detail=False)
    def login(self, request):
        username = request.data.get('username')
        password = request.data.get('password')
        user = User.objects.filter(username=username, password=password).first()
        print(user.username,user.password,user.user_type)
        if user:
            # 登陆成功
            token = str(uuid.uuid4())
            # 根据name检索,如果有token则更新,没有token则新增
            UserToken.objects.update_or_create(name=user, defaults={'token': token})
            # 将token给到前端
            return Response({'code': 100, 'msg': '登陆成功', 'token': token})
        else:
            return Response({'code': 101, 'msg': '用户名或密码错误,登陆失败'})

```
## 配置路由
```py
# 主路由
from django.contrib import admin
from django.urls import path,include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('loginapp/', include('loginapp.urls')),
]

# 子路由
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import views

router = DefaultRouter()
router.register('user', views.UserView, 'user')     # 生成的路由是user/请求函数名/
urlpatterns = [
    path('', include(router.urls)),
]
```
## 启动项目测试API
```sh
python manage.py runserver   # api路径:http://127.0.0.1:8000/loginapp/user/login/
```


