## 过滤
- 过滤只适用查询所有接口
#### 新建一个示例app并注册
```sh
python manage.py startapp filter_app
```

#### 配置表模型并激活
```py
from django.db import models


class Book(models.Model):
    name = models.CharField(max_length=32)
    price = models.IntegerField()
    author = models.CharField(max_length=32)
```
#### 新建序列化器文件serializer.py
```py
from rest_framework import serializers
from .models import Book


class BookSerializer(serializers.ModelSerializer):
    class Meta:
        model = Book
        fields = '__all__'
```
#### 新建自定义过滤类filter.py
```py
from rest_framework.filters import BaseFilterBackend


# 写一个类继承BaseFilterBackend,重写filter_queryset方法,返回过滤后的对象
class BookFilter(BaseFilterBackend):
    def filter_queryset(self, request, queryset, view):
        # 指定过滤字段
        query = request.query_params.get('name')
        if query:
            # 指定匹配方式为模糊匹配
            queryset = queryset.filter(name__contains=query)
        return queryset
```
#### 配置视图类
```py
from .serializer import BookSerializer
from rest_framework.generics import ListAPIView
from rest_framework.viewsets import ViewSetMixin
from rest_framework.filters import SearchFilter
from django_filters.rest_framework import DjangoFilterBackend
from .filter import BookFilter

# 第一种过滤类,内置的SearchFilter
## 过滤字段的指定使用search_fields
## 内置的过滤类必须使用?search=xx来过滤,且不支持并查询
from rest_framework.filters import SearchFilter


class BookView1(ViewSetMixin, ListAPIView):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    # filter_backends继承于GenericAPIView
    filter_backends = [SearchFilter, ]
    # 指定过滤的字段,模糊的或查询(name中模糊匹配到或author中模糊匹配到)
    search_fields = ['name', 'author']


# 第二种过滤类,第三方类DjangoFilterBackend
## 安装:pip install django-filter
## 在配置文件中注册,注意的注册的是django_filters而非django-filter
## 过滤字段的指定使用filterset_fields
## 该过滤类不支持模糊匹配,但支持name=xx&author=xx多项匹配


class BookView2(ViewSetMixin, ListAPIView):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    # filter_backends继承于GenericAPIView,filter_backends用于指定使用那种过滤类
    filter_backends = [DjangoFilterBackend, ]
    # 指定过滤的字段,模糊的或查询(name中模糊匹配到或author中模糊匹配到)
    filterset_fields = ['name', 'author']
    

# 第三种过滤类,自定义过滤类
# 导入filter.py文件中的自定义过滤类,filter_backends指定使用自定义过滤类
# 过滤字段的指定在自定义过滤中已指定,不必再指定过滤字段
class BookView3(ViewSetMixin, ListAPIView):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    # filter_backends继承于GenericAPIView,filter_backends用于指定使用那种过滤类
    filter_backends = [BookFilter, ]
```
#### 配置路由
```py
# 主路由
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    ... ,
    path('filter_app/', include('filter_app.urls')),
]
# 子路由
from django.urls import path, include
from .views import BookView
from rest_framework.routers import DefaultRouter


router = DefaultRouter()
router.register('books', BookView, 'books')

urlpatterns = [
    path('', include(router.urls)),
]
```
#### 运行项目测试带过滤的API
```sh
python manage.py runserver
```
- 接口地址
```sh
http://127.0.0.1:8000/filter_app/books1/?search=梦
http://127.0.0.1:8000/filter_app/books2/?name=红楼梦&author=曹雪芹
http://127.0.0.1:8000/filter_app/books3/?name=梦
```
